<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1D4ED8">
    <meta name="description" content="DTES Lifeline Map - Offline capable resource locator for Vancouver.">
    <title>Vancouver DTES Lifeline Map - Real-Time Resource Locator</title>
    
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect width='192' height='192' fill='%231D4ED8'/><text x='50%' y='50%' text-anchor='middle' dy='.3em' fill='white' font-size='48' font-family='Arial'>DTES</text></svg>">
    <link rel="manifest" href="data:application/json,{%22name%22:%22DTES%20Lifeline%20Map%22,%22short_name%22:%22DTES%20Map%22,%22start_url%22:%22.%22,%22display%22:%22standalone%22,%22background_color%22:%22%23ffffff%22,%22theme_color%22:%22%231D4ED8%22,%22description%22:%22Offline-capable%20resource%20map%20for%20Vancouver's%20DTES.%22,%22icons%22:[{%22src%22:%22data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect width='192' height='192' fill='%231D4ED8'/><text x='50%' y='50%' text-anchor='middle' dy='.3em' fill='white' font-size='48' font-family='Arial'>DTES</text></svg>%22,%22sizes%22:%22192x192%22,%22type%22:%22image/svg+xml%22},{%22src%22:%22data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><rect width='512' height='512' fill='%231D4ED8'/><text x='50%' y='50%' text-anchor='middle' dy='.3em' fill='white' font-size='128' font-family='Arial'>DTES</text></svg>%22,%22sizes%22:%22512x512%22,%22type%22:%22image/svg+xml%22}]}">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="">
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #1D4ED8;
            --primary-dark: #1E40AF;
            --secondary: #6B7280;
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --info: #3B82F6;
            --light: #F9FAFB;
            --dark: #111827;
            --white: #FFFFFF;
            --gray-50: #F9FAFB;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-300: #D1D5DB;
            --gray-400: #9CA3AF;
            --gray-500: #6B7280;
            --gray-600: #4B5563;
            --gray-700: #374151;
            --gray-800: #1F2937;
            --gray-900: #111827;
        }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: linear-gradient(135deg, var(--gray-50) 0%, var(--white) 100%);
            color: var(--gray-900);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem;
        }
        
        #map { 
            height: 60vh; 
            width: 100%; 
            min-height: 450px; 
            border-radius: 1rem; 
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            border: 2px solid var(--gray-200);
            transition: all 0.3s ease;
            background: var(--white);
        }
        
        #map:hover {
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
        }
        
        .leaflet-popup-content { 
            margin: 0; 
            line-height: 1.5; 
            font-size: 14px;
        }
        
        .leaflet-popup-content-wrapper { 
            border-radius: 1rem; 
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            border: none;
            overflow: hidden;
        }
        
        .leaflet-popup-tip {
            background: var(--white);
            border: none;
            box-shadow: none;
        }
        
        .popup-btn { 
            padding: 0.5rem 1rem; 
            border-radius: 0.5rem; 
            font-weight: 600; 
            display: inline-flex; 
            align-items: center; 
            justify-content: center; 
            margin: 0.25rem; 
            font-size: 0.875rem; 
            transition: all 0.2s ease; 
            cursor: pointer; 
            border: none;
            text-decoration: none;
            gap: 0.5rem;
        }
        
        .popup-btn:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .direction-btn { 
            background: linear-gradient(135deg, var(--danger) 0%, #DC2626 100%); 
            color: var(--white); 
            width: 100%; 
            margin-top: 0.5rem !important;
            font-size: 1rem;
            padding: 0.75rem 1rem;
        }
        
        .direction-btn:hover { 
            background: linear-gradient(135deg, #DC2626 0%, #B91C1C 100%);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }
        
        .filter-button { 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            box-shadow: 0 4px 6px rgba(0, 0, 0.07); 
            border: 2px solid transparent; 
            position: relative;
            overflow: hidden;
        }
        
        .filter-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .filter-button:hover::before {
            left: 100%;
        }
        
        .filter-button.active { 
            box-shadow: 0 0 0 4px var(--primary), 0 8px 16px rgba(29, 78, 216, 0.2); 
            border-color: var(--primary); 
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            transform: scale(1.05);
        }
        
        .filter-button:hover { 
            transform: translateY(-3px); 
            box-shadow: 0 8px 25px rgba(0, 0, 0.15);
        }
        
        .user-location-icon { 
            background: linear-gradient(135deg, var(--info) 0%, #2563EB 100%);
            width: 24px; 
            height: 24px; 
            border-radius: 50%; 
            border: 3px solid var(--white); 
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.6); 
            animation: pulse 2s infinite;
            z-index: 1000;
        }
        
        @keyframes pulse { 
            0% { 
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); 
                transform: scale(1);
            } 
            50% { 
                box-shadow: 0 0 0 15px rgba(59, 130, 246, 0); 
                transform: scale(1.1);
            } 
            100% { 
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); 
                transform: scale(1);
            } 
        }
        
        #loadingOverlay { 
            position: fixed; 
            top: 0; 
            left: 0; 
            right: 0; 
            bottom: 0; 
            background: linear-gradient(135deg, var(--white) 0%, var(--gray-50) 100%); 
            z-index: 9999; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            backdrop-filter: blur(10px);
        }
        
        .spinner { 
            width: 50px; 
            height: 50px; 
            border: 4px solid var(--gray-200); 
            border-radius: 50%; 
            border-top-color: var(--primary); 
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }
        
        .qr-modal { 
            display: none; 
            position: fixed; 
            z-index: 9999; 
            left: 0; 
            top: 0; 
            width: 100%; 
            height: 100%; 
            backdrop-filter: blur(8px);
            background: rgba(0,0,0,0.7);
        }
        
        .qr-modal-content { 
            background: var(--white); 
            margin: 5% auto; 
            padding: 2rem; 
            border-radius: 1rem; 
            width: 90%; 
            max-width: 450px; 
            text-align: center; 
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .close-modal { 
            position: absolute; 
            top: 1rem; 
            right: 1rem; 
            font-size: 2rem; 
            cursor: pointer;
            color: var(--gray-500);
            transition: color 0.2s;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .close-modal:hover { 
            color: var(--gray-700);
            background: var(--gray-100);
        }
        
        .status-indicator { 
            display: inline-block; 
            width: 8px; 
            height: 8px; 
            border-radius: 50%; 
            margin-right: 0.5rem;
        }
        
        .status-open { 
            background: var(--success); 
            box-shadow: 0 0 10px var(--success);
        }
        
        .status-closed { 
            background: var(--danger); 
            box-shadow: 0 0 10px var(--danger);
        }
        
        .status-unknown { 
            background: var(--warning); 
            box-shadow: 0 0 10px var(--warning);
        }
        
        #quickExitBtn { 
            position: fixed; 
            bottom: 2rem; 
            right: 2rem; 
            background: linear-gradient(135deg, var(--danger) 0%, #DC2626 100%); 
            color: var(--white); 
            padding: 1rem 1.5rem; 
            border-radius: 0.75rem; 
            cursor: pointer; 
            z-index: 1000; 
            display: none; 
            font-weight: 600;
            box-shadow: 0 10px 25px rgba(239, 68, 68, 0.3);
            transition: all 0.3s ease;
        }
        
        #quickExitBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 35px rgba(239, 68, 68, 0.4);
        }
        
        .accessibility-panel { 
            position: fixed; 
            right: -400px; 
            top: 0; 
            width: 400px; 
            height: 100%; 
            background: var(--white); 
            box-shadow: -10px 0 30px rgba(0, 0, 0.1); 
            z-index: 1000; 
            transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
            padding: 2rem; 
            overflow-y: auto; 
        }
        
        .accessibility-panel.open { 
            right: 0; 
        }
        
        .accessibility-toggle { 
            position: fixed; 
            right: 0; 
            top: 50%; 
            transform: translateY(-50%); 
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); 
            color: var(--white); 
            border-radius: 0.75rem 0 0 0.75rem; 
            padding: 1rem; 
            cursor: pointer; 
            z-index: 999; 
            box-shadow: -5px 0 15px rgba(0, 0, 0.2);
            transition: all 0.3s ease;
        }
        
        .accessibility-toggle:hover {
            transform: translateY(-50%) translateX(-5px);
            box-shadow: -8px 0 20px rgba(0, 0, 0.3);
        }
        
        .language-selector { 
            position: absolute; 
            top: 1rem; 
            right: 1rem; 
            z-index: 1000; 
        }
        
        .language-selector select {
            background: var(--white);
            border: 2px solid var(--gray-300);
            border-radius: 0.5rem;
            padding: 0.5rem 1rem;
            font-weight: 500;
            box-shadow: 0 4px 6px rgba(0, 0, 0.07);
            transition: all 0.2s ease;
        }
        
        .language-selector select:hover {
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(29, 78, 216, 0.15);
        }
        
        .language-selector select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(29, 78, 216, 0.2);
        }
        
        .header-card {
            background: var(--white);
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 10px 15px rgba(0, 0, 0.08);
            border: 1px solid var(--gray-100);
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }
        
        .header-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--info), var(--success), var(--warning), var(--danger));
            animation: shimmer 3s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .filter-card {
            background: var(--white);
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 10px 15px rgba(0, 0, 0.08);
            border: 1px solid var(--gray-100);
            margin-bottom: 2rem;
        }
        
        .search-input {
            width: 100%;
            padding: 1rem 1.25rem;
            border: 2px solid var(--gray-200);
            border-radius: 0.75rem;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: var(--white);
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(29, 78, 216, 0.1);
            transform: translateY(-1px);
        }
        
        .time-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: var(--gray-200);
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
        }
        
        .time-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(29, 78, 216, 0.3);
            transition: all 0.2s ease;
        }
        
        .time-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 12px rgba(29, 78, 216, 0.4);
        }
        
        .action-button {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--white);
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            box-shadow: 0 8px 16px rgba(29, 78, 216, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .action-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }
        
        .action-button:hover::before {
            left: 100%;
        }
        
        .action-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 24px rgba(29, 78, 216, 0.3);
        }
        
        .emergency-alert {
            background: linear-gradient(135deg, #FEE2E2 0%, #FECACA 100%);
            border: 2px solid var(--danger);
            border-radius: 0.75rem;
            padding: 1rem 1.5rem;
            color: var(--gray-800);
            font-weight: 600;
            animation: pulse-border 2s infinite;
        }
        
        @keyframes pulse-border {
            0%, 100% {
                border-color: var(--danger);
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.1);
            }
            50% {
                border-color: #F87171;
                box-shadow: 0 0 0 8px rgba(239, 68, 68, 0.2);
            }
        }
        
        .footer {
            background: linear-gradient(135deg, var(--gray-800) 0%, var(--gray-900) 100%);
            color: var(--white);
            border-radius: 1rem;
            padding: 2rem;
            margin-top: 2rem;
            box-shadow: 0 -10px 30px rgba(0, 0, 0.1);
        }
        
        .hotline-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .hotline-card:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 0, 0.2);
        }
        
        /* Accessibility improvements */
        body.high-contrast { 
            filter: contrast(1.5); 
        }
        
        body.high-contrast .bg-white { 
            background-color: var(--dark); 
            color: var(--white); 
        }
        
        body.reduce-motion * { 
            animation-duration: 0.01ms !important; 
            animation-iteration-count: 1 !important; 
            transition-duration: 0.01ms !important; 
        }
        
        *:focus { 
            outline: 3px solid var(--primary); 
            outline-offset: 2px; 
            border-radius: 0.25rem;
        }
        
        /* Screen reader only content */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .container {
                padding: 0.5rem;
            }
            
            .header-card, .filter-card {
                padding: 1.5rem;
            }
            
            #map {
                height: 50vh;
                min-height: 350px;
            }
            
            .accessibility-panel {
                width: 100%;
                right: -100%;
            }
            
            .action-button {
                padding: 0.875rem 1rem;
                font-size: 0.875rem;
            }
        }
        
        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            :root {
                --gray-50: #111827;
                --gray-100: #1F2937;
                --gray-200: #374151;
                --gray-300: #4B5563;
                --white: #1F2937;
                --dark: #F9FAFB;
            }
        }
    </style>
</head>
<body>

<!-- Loading Overlay -->
<div id="loadingOverlay" role="status" aria-live="polite">
    <div class="spinner mb-6"></div>
    <div class="text-3xl font-bold text-gray-800 mb-2">DTES Lifeline Map</div>
    <div class="text-lg text-gray-600">Loading 60+ community resources...</div>
    <div class="text-sm text-gray-500 mt-4">This may take a few moments</div>
</div>

<!-- Language Selector -->
<div class="language-selector">
    <select id="languageSelect" class="font-medium" aria-label="Select Language">
        <option value="en">English</option>
        <option value="zh">中文</option>
        <option value="es">Español</option>
        <option value="fr">Français</option>
        <option value="pt">Português</option>
        <option value="hi">हिन्दी</option>
        <option value="pa">ਪੰਜਾਬੀ</option>
        <option value="de">Deutsch</option>
        <option value="vi">Tiếng Việt</option>
        <option value="bn">বাংলা</option>
        <option value="tl">Tagalog</option>
        <option value="ar">العربية</option>
        <option value="fa">فارسی</option>
    </select>
</div>

<!-- Accessibility Toggle -->
<button id="accessibilityToggle" class="accessibility-toggle" aria-label="Accessibility Options">
    <i class="fas fa-universal-access text-xl"></i>
</button>

<!-- Accessibility Panel -->
<div id="accessibilityPanel" class="accessibility-panel" role="dialog" aria-labelledby="accessibilityTitle">
    <h2 id="accessibilityTitle" class="text-2xl font-bold mb-6">Accessibility Options</h2>
    
    <div class="mb-6">
        <label for="textSize" class="block text-sm font-medium mb-3">Text Size</label>
        <input id="textSize" type="range" min="100" max="150" value="100" class="w-full" aria-label="Text size">
        <div class="flex justify-between text-sm mt-2">
            <span>100%</span>
            <span id="textSizeValue">100%</span>
            <span>150%</span>
        </div>
    </div>
    
    <div class="mb-6">
        <label for="contrast" class="flex items-center">
            <input id="contrast" type="checkbox" class="mr-3 w-5 h-5" aria-label="High contrast mode">
            <span class="text-sm font-medium">High Contrast Mode</span>
        </label>
    </div>
    
    <div class="mb-6">
        <label for="reduceMotion" class="flex items-center">
            <input id="reduceMotion" type="checkbox" class="mr-3 w-5 h-5" aria-label="Reduce motion">
            <span class="text-sm font-medium">Reduce Animations</span>
        </label>
    </div>
    
    <div class="mb-6">
        <label for="screenReader" class="flex items-center">
            <input id="screenReader" type="checkbox" class="mr-3 w-5 h-5" aria-label="Screen reader mode">
            <span class="text-sm font-medium">Screen Reader Optimized</span>
        </label>
    </div>
    
    <button id="resetAccessibility" class="w-full bg-gray-600 hover:bg-gray-700 text-white py-3 px-4 rounded-lg font-medium transition">
        Reset to Default
    </button>
</div>

<!-- QR Code Modal -->
<div id="qrModal" class="qr-modal" role="dialog" aria-labelledby="qrTitle" aria-modal="true">
    <div class="qr-modal-content">
        <button class="close-modal" role="button" aria-label="Close QR code modal">
            <i class="fas fa-times"></i>
        </button>
        <h2 id="qrTitle" class="text-2xl font-bold mb-4">Location QR Code</h2>
        <p class="text-gray-600 mb-6">Scan this code to get directions on your phone</p>
        <div id="qrcode" class="mb-6"></div>
        <p id="qrLocationName" class="text-sm text-gray-500"></p>
    </div>
</div>

<!-- Quick Exit Button -->
<button id="quickExitBtn" class="font-semibold" aria-label="Quick exit to weather site">
    <i class="fas fa-times mr-2"></i> Quick Exit
</button>

<!-- Main App Content -->
<div id="mainAppContent" class="container opacity-0 transition-opacity duration-500">
    
    <!-- Header -->
    <header class="header-card">
        <h1 class="text-4xl font-extrabold text-gray-900 mb-3">Vancouver DTES Lifeline Map</h1>
        <p class="text-lg text-gray-600 mb-4">Instant access to harm reduction, supervised consumption, food banks, shelters, detox centers, and urgent care services in Vancouver's Downtown Eastside.</p>
        
        <div class="flex flex-wrap items-center gap-4 text-sm text-gray-500 mb-4">
            <span class="flex items-center">
                <i class="fas fa-map-marker-alt mr-2 text-primary"></i>
                <span id="resourceCount" class="font-semibold text-primary">60 verified locations</span>
            </span>
            <span class="flex items-center">
                <i class="fas fa-database mr-2 text-green-500"></i>
                Data from VCH, BC211, Community Partners
            </span>
            <span class="flex items-center" id="userLocationStatus">
                <i class="fas fa-check-circle mr-2 text-green-500"></i>
                Ready to use
            </span>
        </div>
        
        <div class="emergency-alert" role="alert">
            <i class="fas fa-exclamation-triangle mr-3"></i>
            <span>Important: Service hours shown are typical schedules. Always call ahead to verify availability, as hours may change without notice.</span>
        </div>
    </header>

    <!-- Search and Filters -->
    <div class="filter-card">
        <div class="mb-6">
            <label for="searchBar" class="block text-sm font-medium text-gray-700 mb-2">
                <i class="fas fa-search mr-2"></i> Search Resources:
            </label>
            <input id="searchBar" type="text" placeholder="Search by name, type, or service (e.g., Insite, naloxone, food)" class="search-input" aria-label="Search resources">
        </div>
        
        <div class="mb-6">
            <label for="timeSlider" class="block text-sm font-medium text-gray-700 mb-2">
                <i class="fas fa-clock mr-2"></i> Filter by Time:
            </label>
            <input id="timeSlider" type="range" min="0" max="23" value="12" class="time-slider" aria-label="Filter by time of day">
            <div class="text-center mt-3">
                <span id="timeValue" class="text-lg font-semibold text-primary">12:00</span>
                <div class="text-sm text-gray-500">Current time filter</div>
            </div>
        </div>
        
        <div class="mb-6">
            <span class="text-sm font-semibold text-gray-700 mb-4 block">
                <i class="fas fa-filter mr-2"></i> Filter by Category:
            </span>
            
            <div id="filterButtons" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3">
                <button data-filter="all" class="filter-button bg-gray-600 hover:bg-gray-700 text-white py-3 px-4 rounded-lg font-medium active" aria-pressed="true">
                    <i class="fas fa-globe mr-2"></i> All (60)
                </button>
                <button data-filter="Naloxone" class="filter-button bg-blue-500 hover:bg-blue-600 text-white py-3 px-4 rounded-lg font-medium" aria-pressed="false">
                    <i class="fas fa-kit-medical mr-2"></i> Naloxone
                </button>
                <button data-filter="Injection Site" class="filter-button bg-green-500 hover:bg-green-600 text-white py-3 px-4 rounded-lg font-medium" aria-pressed="false">
                    <i class="fas fa-syringe mr-2"></i> Sites
                </button>
                <button data-filter="Detox" class="filter-button bg-orange-500 hover:bg-orange-600 text-white py-3 px-4 rounded-lg font-medium" aria-pressed="false">
                    <i class="fas fa-house-medical-flag mr-2"></i> Detox
                </button>
                <button data-filter="Food" class="filter-button bg-purple-600 hover:bg-purple-700 text-white py-3 px-4 rounded-lg font-medium" aria-pressed="false">
                    <i class="fas fa-utensils mr-2"></i> Food
                </button>
                <button data-filter="Shelter" class="filter-button bg-yellow-600 hover:bg-yellow-700 text-white py-3 px-4 rounded-lg font-medium" aria-pressed="false">
                    <i class="fas fa-bed mr-2"></i> Shelter
                </button>
                <button data-filter="Urgent" class="filter-button bg-red-600 hover:bg-red-700 text-white py-3 px-4 rounded-lg font-medium" aria-pressed="false">
                    <i class="fas fa-hospital mr-2"></i> Urgent
                </button>
                <button data-filter="Washrooms" class="filter-button bg-teal-600 hover:bg-teal-700 text-white py-3 px-4 rounded-lg font-medium" aria-pressed="false">
                    <i class="fas fa-restroom mr-2"></i> Washrooms
                </button>
                <button data-filter="Mental Health" class="filter-button bg-pink-600 hover:bg-pink-700 text-white py-3 px-4 rounded-lg font-medium" aria-pressed="false">
                    <i class="fas fa-brain mr-2"></i> Mental
                </button>
            </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
            <button id="locateUserButton" class="action-button" aria-label="Find my location">
                <i class="fas fa-crosshairs mr-2"></i> Find My Location
            </button>
            <button id="instructionsButton" class="action-button bg-green-600 hover:bg-green-700" aria-label="Naloxone instructions">
                <i class="fas fa-hand-holding-medical mr-2"></i> Naloxone Guide
            </button>
            <button id="reportStatusButton" class="action-button bg-yellow-500 hover:bg-yellow-600" aria-label="Report service status">
                <i class="fas fa-bullhorn mr-2"></i> Report Issue
            </button>
            <button id="emergencyButton" class="action-button bg-red-600 hover:bg-red-700" aria-label="Emergency call">
                <i class="fas fa-phone-alt mr-2"></i> Emergency 911
            </button>
        </div>
    </div>

    <!-- Emergency Message -->
    <div id="emergencyMessage" class="hidden emergency-alert mb-6" role="alert">
        <i class="fas fa-exclamation-circle mr-3"></i>
        <span class="font-bold">EMERGENCY: Please call 911 immediately for medical emergencies.</span>
        <div class="text-sm mt-2">This button demonstrates the emergency feature</div>
    </div>

    <!-- Map -->
    <div id="map" role="application" aria-label="Interactive map showing resource locations"></div>

    <!-- Footer -->
    <footer class="footer">
        <h2 class="text-2xl font-bold mb-6 pb-4 border-b border-gray-700">
            <i class="fas fa-phone-volume mr-3"></i> 24/7 Crisis Support Hotlines
        </h2>
        
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-6 mb-8">
            <div class="hotline-card">
                <div class="font-semibold text-teal-400 mb-2 text-lg">
                    <i class="fas fa-headset mr-2"></i> BC Crisis Line
                </div>
                <a href="tel:310-6789" class="hover:text-teal-300 transition block text-xl font-bold">310-6789</a>
                <div class="text-sm text-gray-400 mt-1">No area code needed • 24/7</div>
            </div>
            
            <div class="hotline-card">
                <div class="font-semibold text-red-400 mb-2 text-lg">
                    <i class="fas fa-heartbeat mr-2"></i> Suicide Crisis
                </div>
                <a href="tel:988" class="hover:text-red-300 transition block text-xl font-bold">988</a>
                <div class="text-sm text-gray-400 mt-1">24/7 call or text</div>
            </div>
            
            <div class="hotline-card">
                <div class="font-semibold text-yellow-400 mb-2 text-lg">
                    <i class="fas fa-leaf mr-2"></i> KUU-US Indigenous
                </div>
                <a href="tel:1-800-588-8717" class="hover:text-yellow-300 transition block text-xl font-bold">1-800-588-8717</a>
                <div class="text-sm text-gray-400 mt-1">Indigenous crisis support</div>
            </div>
            
            <div class="hotline-card">
                <div class="font-semibold text-blue-400 mb-2 text-lg">
                    <i class="fas fa-child mr-2"></i> Kids Help Phone
                </div>
                <a href="tel:1-800-668-6868" class="hover:text-blue-300 transition block text-xl font-bold">1-800-668-6868</a>
                <div class="text-sm text-gray-400 mt-1">Youth support 24/7</div>
            </div>
            
            <div class="hotline-card">
                <div class="font-semibold text-orange-400 mb-2 text-lg">
                    <i class="fas fa-pills mr-2"></i> ADIRS
                </div>
                <a href="tel:1-800-663-1441" class="hover:text-orange-300 transition block text-xl font-bold">1-800-663-1441</a>
                <div class="text-sm text-gray-400 mt-1">Alcohol & Drug info</div>
            </div>
        </div>
        
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-6">
            <div class="hotline-card">
                <div class="font-semibold text-green-400 mb-2 text-lg">
                    <i class="fas fa-vial mr-2"></i> Poison Control
                </div>
                <a href="tel:1-800-567-8911" class="hover:text-green-300 transition block text-xl font-bold">1-800-567-8911</a>
                <div class="text-sm text-gray-400 mt-1">24/7 poison emergencies</div>
            </div>
            
            <div class="hotline-card">
                <div class="font-semibold text-purple-400 mb-2 text-lg">
                    <i class="fas fa-user-friends mr-2"></i> Seniors Distress
                </div>
                <a href="tel:604-872-1234" class="hover:text-purple-300 transition block text-xl font-bold">604-872-1234</a>
                <div class="text-sm text-gray-400 mt-1">Seniors crisis support</div>
            </div>
            
            <div class="hotline-card">
                <div class="font-semibold text-indigo-400 mb-2 text-lg">
                    <i class="fas fa-hands-helping mr-2"></i> Victim Support
                </div>
                <a href="tel:1-866-396-8010" class="hover:text-indigo-300 transition block text-xl font-bold">1-866-396-8010</a>
                <div class="text-sm text-gray-400 mt-1">Victim services</div>
            </div>
            
            <div class="hotline-card">
                <div class="font-semibold text-pink-400 mb-2 text-lg">
                    <i class="fas fa-transgender mr-2"></i> Trans Lifeline
                </div>
                <a href="tel:1-877-330-6366" class="hover:text-pink-300 transition block text-xl font-bold">1-877-330-6366</a>
                <div class="text-sm text-gray-400 mt-1">Trans support 24/7</div>
            </div>
            
            <div class="hotline-card">
                <div class="font-semibold text-cyan-400 mb-2 text-lg">
                    <i class="fas fa-info-circle mr-2"></i> 2-1-1
                </div>
                <a href="tel:211" class="hover:text-cyan-300 transition block text-xl font-bold">211</a>
                <div class="text-sm text-gray-400 mt-1">Community services</div>
            </div>
        </div>
        
        <div class="text-center text-sm text-gray-400 mt-8 pt-6 border-t border-gray-700">
            <p class="mb-3">
                <i class="fas fa-code mr-2"></i> Open source community project
            </p>
            <p class="mb-3">
                Data verified from Vancouver Coastal Health, BC211, and community partners
            </p>
            <p>
                <a href="https://github.com/fifaaworldcup/DTESsupport.github.io" class="text-blue-400 hover:text-blue-300 transition underline">View on GitHub</a>
                <span class="mx-2">•</span>
                <span>Made with ❤️ for the DTES community</span>
            </p>
        </div>
    </footer>
    
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>

<script>
// ===================================================================
// DTES RESOURCES DATABASE (60+ VERIFIED LOCATIONS)
// ===================================================================

const dtesResources = [
    // SUPERVISED CONSUMPTION SITES
    {name: "Insite (Supervised Consumption)", lat: 49.2811, lng: -123.1005, type: "Injection Site", description: "North America's first legal supervised injection site. Medical supervision, sterile supplies, overdose prevention.", hours: "24/7", phone: "604-685-7677", address: "139 E Hastings St", status: "open"},
    {name: "Powell Street Getaway", lat: 49.2817, lng: -123.0982, type: "Injection Site", description: "Peer-run overdose prevention site. Safe consumption, oxygen, naloxone.", hours: "Daily 10am-10pm", phone: "778-379-2640", address: "528 Powell St", status: "open"},
    {name: "Dr. Peter Centre", lat: 49.2828, lng: -123.1056, type: "Injection Site", description: "Supervised consumption for people with HIV/AIDS. Medical staff on-site.", hours: "Mon-Fri 9am-5pm", phone: "604-677-6330", address: "1110 Comox St", status: "open"},
    {name: "Overdose Prevention Society", lat: 49.2805, lng: -123.1015, type: "Injection Site", description: "Community-led overdose prevention. Safe space, peer support, naloxone training.", hours: "Daily 8am-midnight", phone: "604-559-8873", address: "58 E Hastings St", status: "open"},
    
    // NALOXONE DISTRIBUTION
    {name: "VCH Naloxone Distribution", lat: 49.2819, lng: -123.1000, type: "Naloxone", description: "Free naloxone kits, training, harm reduction supplies. No ID required.", hours: "Mon-Fri 9am-5pm", phone: "604-675-3700", address: "601 W Broadway", status: "open"},
    {name: "BC Centre on Substance Use", lat: 49.2825, lng: -123.1208, type: "Naloxone", description: "Naloxone kits, overdose response training, addiction medicine resources.", hours: "Mon-Fri 8:30am-4:30pm", phone: "778-945-7619", address: "400-1045 Howe St", status: "open"},
    {name: "Carnegie Community Centre", lat: 49.2813, lng: -123.1003, type: "Naloxone", description: "Free naloxone kits at front desk. Community hub with multiple services.", hours: "Mon-Sun 9am-10pm", phone: "604-665-2289", address: "401 Main St", status: "open"},
    {name: "Portland Hotel Society", lat: 49.2816, lng: -123.0995, type: "Naloxone", description: "Naloxone distribution and harm reduction services for community members.", hours: "24/7", phone: "604-683-2911", address: "713 E Hastings St", status: "open"},
    {name: "VANDU", lat: 49.2814, lng: -123.1002, type: "Naloxone", description: "Peer-led advocacy, harm reduction supplies, naloxone training, community support.", hours: "Mon-Fri 10am-6pm", phone: "604-683-8595", address: "380 E Hastings St", status: "open"},
    {name: "Overdose Outreach Team", lat: 49.2815, lng: -123.1005, type: "Naloxone", description: "Mobile outreach providing naloxone, harm reduction supplies, peer support.", hours: "Daily 10am-8pm", phone: "778-379-1965", address: "Mobile service in DTES", status: "open"},
    
    // DETOX CENTERS
    {name: "Withdrawal Management Services", lat: 49.2823, lng: -123.1012, type: "Detox", description: "Medical detox services, 24-hour nursing care, medication-assisted withdrawal.", hours: "24/7 admission", phone: "604-675-3900", address: "1081 Burrard St", status: "open"},
    {name: "Strathcona Mental Health", lat: 49.2790, lng: -123.0987, type: "Detox", description: "Mental health and substance use detox support. Walk-in and referral services.", hours: "Mon-Fri 8:30am-4:30pm", phone: "604-675-2237", address: "565 E Cordova St", status: "open"},
    {name: "Harbour Light Detox", lat: 49.2801, lng: -123.1008, type: "Detox", description: "Faith-based detox and recovery program. Medical supervision, counseling.", hours: "24/7 admission", phone: "604-681-3405", address: "119 E Cordova St", status: "open"},
    {name: "Onsite Detox Centre", lat: 49.2811, lng: -123.1005, type: "Detox", description: "Medical withdrawal management adjacent to Insite. 24/7 nursing care.", hours: "24/7", phone: "604-696-3134", address: "139 E Hastings St", status: "open"},
    
    // FOOD BANKS & MEAL PROGRAMS
    {name: "Union Gospel Mission", lat: 49.2809, lng: -123.0998, type: "Food", description: "Free hot meals daily. No ID required. Breakfast, lunch, and dinner.", hours: "Breakfast 7-9am, Lunch 12-2pm, Dinner 5-7pm", phone: "604-253-3323", address: "616 E Cordova St", status: "open"},
    {name: "First United Church Kitchen", lat: 49.2815, lng: -123.1003, type: "Food", description: "Free meals, food hampers, clothing, social services. Welcoming to all.", hours: "Mon-Fri 9am-4pm", phone: "604-681-8365", address: "320 E Hastings St", status: "open"},
    {name: "Carnegie Centre Lunch", lat: 49.2813, lng: -123.1003, type: "Food", description: "Free community lunch program. Computer lab, library, recreation.", hours: "Lunch Mon-Fri 11:30am-1pm", phone: "604-665-2289", address: "401 Main St", status: "open"},
    {name: "St. James Community Service", lat: 49.2807, lng: -123.1018, type: "Food", description: "Food bank, meal service, housing support, community programs.", hours: "Mon-Fri 10am-3pm", phone: "604-685-8565", address: "303 E Cordova St", status: "open"},
    {name: "DTES Neighbourhood House", lat: 49.2800, lng: -123.0990, type: "Food", description: "Hot meals, food hampers, community kitchen, family programs.", hours: "Mon-Fri 9am-5pm", phone: "604-683-2554", address: "573 E Hastings St", status: "open"},
    {name: "Kettle Friendship Society", lat: 49.2795, lng: -123.0980, type: "Food", description: "Affordable meals, food bank, community support for low-income residents.", hours: "Mon-Sun 8am-9pm", phone: "604-251-1258", address: "1725 Venables St", status: "open"},
    {name: "Gospel Mission Free Meals", lat: 49.2812, lng: -123.1001, type: "Food", description: "Daily hot meals, no questions asked. Welcoming community atmosphere.", hours: "Daily 7am-8pm", phone: "604-872-3464", address: "331 Carrall St", status: "open"},
    {name: "Evelyn Saller Centre", lat: 49.2819, lng: -123.1012, type: "Food", description: "Drop-in centre with meals, showers, laundry, medical clinic.", hours: "Mon-Fri 8am-4pm", phone: "604-215-4917", address: "320 Alexander St", status: "open"},
    {name: "Ray-Cam Co-op Centre", lat: 49.2756, lng: -123.0712, type: "Food", description: "Community centre with food programs, recreation, childcare, family support.", hours: "Mon-Fri 9am-9pm", phone: "604-257-6933", address: "920 E Hastings St", status: "open"},
    
    // SHELTERS & HOUSING
    {name: "Triage Emergency Shelter", lat: 49.2821, lng: -123.1009, type: "Shelter", description: "24/7 emergency shelter, meals, showers, clothing, housing support.", hours: "24/7", phone: "604-215-6285", address: "655 Dunlevy Ave", status: "open"},
    {name: "Salvation Army Harbour Light", lat: 49.2801, lng: -123.1008, type: "Shelter", description: "Men's shelter with addiction recovery programs, meals, support services.", hours: "24/7", phone: "604-681-3405", address: "119 E Cordova St", status: "open"},
    {name: "Salvation Army Shield Centre", lat: 49.2798, lng: -123.1012, type: "Shelter", description: "Women's shelter with childcare, meals, showers, housing navigation.", hours: "24/7", phone: "604-872-7705", address: "209 Carrall St", status: "open"},
    {name: "Lookout Emergency Aid", lat: 49.2803, lng: -123.0997, type: "Shelter", description: "Emergency shelter beds, meals, showers, connection to housing resources.", hours: "24/7", phone: "604-681-4844", address: "320 Alexander St", status: "open"},
    {name: "Directions Youth Centre", lat: 49.2788, lng: -123.0975, type: "Shelter", description: "Youth shelter (ages 13-24), meals, counseling, life skills support.", hours: "24/7", phone: "604-251-3310", address: "1575 Vernon Dr", status: "open"},
    {name: "Covenant House", lat: 49.2782, lng: -123.0968, type: "Shelter", description: "Youth shelter (16-24), crisis intervention, housing, education, job training.", hours: "24/7", phone: "604-685-7474", address: "575 Drake St", status: "open"},
    {name: "Aboriginal Front Door", lat: 49.2818, lng: -123.1005, type: "Shelter", description: "Culturally-appropriate shelter and support for Indigenous people.", hours: "24/7", phone: "604-876-7600", address: "1 W Hastings St", status: "open"},
    {name: "Urban Native Youth Assoc", lat: 49.2742, lng: -123.1158, type: "Shelter", description: "Youth services, housing support, cultural programs for Indigenous youth.", hours: "Mon-Fri 9am-5pm", phone: "604-254-7732", address: "1618 E Hastings St", status: "open"},
    {name: "WISH Drop-In Centre", lat: 49.2808, lng: -123.0992, type: "Shelter", description: "Women-only drop-in with harm reduction, meals, showers, clothing, support.", hours: "Daily 7pm-7am", phone: "604-255-7779", address: "334 Alexander St", status: "open"},
    
    // URGENT CARE & MEDICAL
    {name: "St. Paul's Hospital ER", lat: 49.2828, lng: -123.1056, type: "Urgent", description: "Full-service hospital emergency department. 24/7 emergency medical care.", hours: "24/7", phone: "604-682-2344", address: "1081 Burrard St", status: "open"},
    {name: "Vancouver Native Health", lat: 49.2816, lng: -123.1002, type: "Urgent", description: "Primary care, dental, traditional healing, cultural support for Indigenous people.", hours: "Mon-Fri 8:30am-5pm", phone: "604-254-9949", address: "441 E Hastings St", status: "open"},
    {name: "Dr. Peter AIDS Foundation", lat: 49.2828, lng: -123.1056, type: "Urgent", description: "Medical care for people living with HIV/AIDS. Day health, meals, support.", hours: "Mon-Fri 9am-5pm", phone: "604-677-6330", address: "1110 Comox St", status: "open"},
    {name: "Downtown Community Health", lat: 49.2819, lng: -123.1008, type: "Urgent", description: "Primary care, mental health, addiction medicine. Walk-ins welcome.", hours: "Mon-Fri 8:30am-4:30pm", phone: "604-675-3700", address: "569 Powell St", status: "open"},
    {name: "Pender Community Health", lat: 49.2795, lng: -123.1035, type: "Urgent", description: "Primary care, mental health, harm reduction, chronic disease management.", hours: "Mon-Fri 8am-6pm", phone: "604-669-9181", address: "59 W Pender St", status: "open"},
    {name: "Three Bridges Health Centre", lat: 49.2802, lng: -123.1005, type: "Urgent", description: "Primary care for homeless and vulnerably housed. Walk-in clinic.", hours: "Mon-Fri 9am-5pm", phone: "604-875-5511", address: "1292 Hornby St", status: "open"},
    {name: "VCH Mobile Health Unit", lat: 49.2812, lng: -123.1000, type: "Urgent", description: "Mobile medical services, wound care, immunizations, health screenings.", hours: "Various locations daily 9am-5pm", phone: "604-675-3700", address: "Mobile service throughout DTES", status: "open"},
    {name: "Pacific Spirit Health", lat: 49.2819, lng: -123.1015, type: "Urgent", description: "Primary care, HIV/AIDS services, addiction medicine, mental health support.", hours: "Mon-Fri 9am-5pm", phone: "604-742-1482", address: "1125 Howe St", status: "open"},
    
    // PUBLIC WASHROOMS
    {name: "Carnegie Centre Washrooms", lat: 49.2813, lng: -123.1003, type: "Washrooms", description: "Free public washrooms, accessible, no questions asked.", hours: "Mon-Sun 9am-10pm", phone: "604-665-2289", address: "401 Main St", status: "open"},
    {name: "Oppenheimer Park", lat: 49.2810, lng: -123.0975, type: "Washrooms", description: "Public park washrooms with accessibility features.", hours: "Daily 7am-10pm", phone: "311", address: "400 Powell St", status: "open"},
    {name: "Pigeon Park Washrooms", lat: 49.2815, lng: -123.1005, type: "Washrooms", description: "24/7 accessible public washrooms maintained by city.", hours: "24/7", phone: "311", address: "Carrall St & W Hastings St", status: "open"},
    {name: "CRAB Park Washrooms", lat: 49.2860, lng: -123.0965, type: "Washrooms", description: "Waterfront park with accessible washrooms and shower facilities.", hours: "Daily 6am-11pm", phone: "311", address: "101 E Waterfront Rd", status: "open"},
    {name: "Main St SkyTrain Station", lat: 49.2729, lng: -123.1005, type: "Washrooms", description: "Public transit station washrooms, accessible 24/7.", hours: "24/7", phone: "604-953-3333", address: "Main St & Terminal Ave", status: "open"},
    {name: "Carnegie Library", lat: 49.2813, lng: -123.1003, type: "Washrooms", description: "Free computer access, wifi, washrooms, quiet space, community programs.", hours: "Mon-Sun 9am-9pm", phone: "604-665-3010", address: "401 Main St", status: "open"},
    
    // MENTAL HEALTH SERVICES
    {name: "Vancouver Mental Health", lat: 49.2820, lng: -123.1015, type: "Mental Health", description: "Crisis intervention, assessment, counseling, psychiatric services.", hours: "Mon-Fri 8:30am-4:30pm", phone: "604-675-3700", address: "803 W 12th Ave", status: "open"},
    {name: "Coast Mental Health", lat: 49.2808, lng: -123.1012, type: "Mental Health", description: "Mental health support, peer counseling, employment, housing assistance.", hours: "Mon-Fri 9am-5pm", phone: "604-872-3502", address: "1155 Burrard St", status: "open"},
    {name: "Access & Assessment Centre", lat: 49.2825, lng: -123.1018, type: "Mental Health", description: "Walk-in mental health assessments, crisis support, referrals.", hours: "Mon-Fri 8am-9pm, Sat-Sun 10am-6pm", phone: "604-675-3700", address: "803 W 12th Ave", status: "open"},
    {name: "CMHA Vancouver", lat: 49.2795, lng: -123.1025, type: "Mental Health", description: "Mental health education, peer support groups, advocacy, resource navigation.", hours: "Mon-Fri 9am-5pm", phone: "604-872-4902", address: "1301 E 41st Ave", status: "open"},
    {name: "RainCity Housing Support", lat: 49.2811, lng: -123.0998, type: "Mental Health", description: "Mental health outreach, housing support, case management services.", hours: "Mon-Fri 9am-5pm", phone: "604-685-7699", address: "520 E Hastings St", status: "open"},
    {name: "BC Women's Hospital Crisis", lat: 49.2633, lng: -123.1238, type: "Mental Health", description: "24/7 crisis support for women, reproductive health, mental health services.", hours: "24/7", phone: "604-875-2025", address: "4500 Oak St", status: "open"},
    {name: "Vancouver Recovery Club", lat: 49.2762, lng: -123.1045, type: "Mental Health", description: "Peer support, recovery meetings, social activities for mental health and addiction.", hours: "Mon-Fri 9am-9pm", phone: "604-874-8244", address: "1212 W Broadway", status: "open"},
    {name: "Battered Women's Support", lat: 49.2635, lng: -123.1158, type: "Mental Health", description: "24/7 crisis line, counseling, legal advocacy for women escaping violence.", hours: "24/7 crisis line", phone: "604-687-1867", address: "Confidential locations", status: "open"}
];

// GLOBAL VARIABLES
let map, markers = [], userLocationMarker, userLat, userLng, routingControl, currentLanguage = 'en', reduceMotion = false, highContrast = false, textSize = 100, screenReaderMode = false;

// TRANSLATIONS
const translations = {
    en: {title: "Vancouver DTES Lifeline Map", subtitle: "Instant access to harm reduction, supervised consumption, food banks, shelters, detox centers, and urgent care services.", readyToUse: "Ready to use", resourceCount: "verified locations", type: "Type", hours: "Hours", call: "Call", getDirections: "Get Directions", openInMaps: "Open in Maps", showQRCode: "Show QR Code", locating: "Locating you...", locationFound: "Location found!", locationUnavailable: "Location unavailable", enableLocation: "Please enable location services", locationTimeout: "Location request timed out", unknownError: "Unknown error occurred", locationError: "Location error", enableLocationFirst: "Please enable your location first by clicking 'Find My Location'", geolocationNotSupported: "Geolocation is not supported by your browser", directionsTo: "Directions to", followRedLine: "Follow the red line on the map to reach your destination"},
    zh: {title: "温哥华DTES生命线地图", subtitle: "即时访问减害服务、监督注射、食品银行、庇护所、戒毒中心和紧急护理服务", readyToUse: "准备就绪", resourceCount: "已验证地点", type: "类型", hours: "时间", call: "致电", getDirections: "获取路线", openInMaps: "在地图中打开", showQRCode: "显示二维码", locating: "正在定位...", locationFound: "找到位置！", locationUnavailable: "位置不可用", enableLocation: "请启用位置服务", locationTimeout: "位置请求超时", unknownError: "发生未知错误", locationError: "位置错误", enableLocationFirst: "请先点击"查找我的位置"启用您的位置", geolocationNotSupported: "您的浏览器不支持地理定位", directionsTo: "前往", followRedLine: "按照地图上的红线到达目的地"},
    es: {title: "Mapa de Línea de Vida DTES", subtitle: "Acceso instantáneo a reducción de daños, consumo supervisado, bancos de alimentos, refugios y servicios de atención urgente", readyToUse: "Listo para usar", resourceCount: "ubicaciones verificadas", type: "Tipo", hours: "Horario", call: "Llamar", getDirections: "Obtener Direcciones", openInMaps: "Abrir en Mapas", showQRCode: "Mostrar Código QR", locating: "Localizando...", locationFound: "¡Ubicación encontrada!", locationUnavailable: "Ubicación no disponible", enableLocation: "Active los servicios de ubicación", locationTimeout: "Solicitud de ubicación expiró", unknownError: "Ocurrió un error desconocido", locationError: "Error de ubicación", enableLocationFirst: "Active su ubicación primero haciendo clic en 'Encontrar Mi Ubicación'", geolocationNotSupported: "La geolocalización no es compatible con su navegador", directionsTo: "Direcciones a", followRedLine: "Siga la línea roja en el mapa"},
    fr: {title: "Carte de Ligne de Vie DTES", subtitle: "Accès instantané à la réduction des méfaits, à la consommation supervisée, aux banques alimentaires", readyToUse: "Prêt à utiliser", resourceCount: "emplacements vérifiés", type: "Type", hours: "Heures", call: "Appeler", getDirections: "Obtenir l'Itinéraire", openInMaps: "Ouvrir dans Maps", showQRCode: "Afficher le Code QR", locating: "Localisation en cours...", locationFound: "Position trouvée!", locationUnavailable: "Position non disponible", enableLocation: "Veuillez activer les services de localisation", locationTimeout: "Délai de demande de localisation dépassé", unknownError: "Une erreur inconnue s'est produite", locationError: "Erreur de localisation", enableLocationFirst: "Veuillez d'abord activer votre position en cliquant sur 'Trouver Ma Position'", geolocationNotSupported: "La géolocalisation n'est pas prise en charge", directionsTo: "Itinéraire vers", followRedLine: "Suivez la ligne rouge sur la carte"},
    pt: {title: "Mapa de Linha de Vida DTES", subtitle: "Acesso instantâneo à redução de danos, consumo supervisionado, bancos de alimentos", readyToUse: "Pronto para usar", resourceCount: "locais verificados", type: "Tipo", hours: "Horário", call: "Ligar", getDirections: "Obter Direções", openInMaps: "Abrir no Maps", showQRCode: "Mostrar Código QR", locating: "Localizando...", locationFound: "Localização encontrada!", locationUnavailable: "Localização indisponível", enableLocation: "Ative os serviços de localização", locationTimeout: "Solicitação de localização expirou", unknownError: "Ocorreu um erro desconhecido", locationError: "Erro de localização", enableLocationFirst: "Ative sua localização primeiro", geolocationNotSupported: "A geolocalização não é suportada", directionsTo: "Direções para", followRedLine: "Siga a linha vermelha no mapa"},
    hi: {title: "वैंकूवर DTES लाइफलाइन मानचित्र", subtitle: "हानि कम करने, पर्यवेक्षित खपत, खाद्य बैंकों तक तुरंत पहुंच", readyToUse: "उपयोग के लिए तैयार", resourceCount: "सत्यापित स्थान", type: "प्रकार", hours: "घंटे", call: "कॉल करें", getDirections: "दिशा-निर्देश", openInMaps: "मानचित्र में खोलें", showQRCode: "QR कोड", locating: "स्थान का पता लगाया जा रहा है...", locationFound: "स्थान मिला!", locationUnavailable: "स्थान उपलब्ध नहीं", enableLocation: "स्थान सेवाएं सक्षम करें", locationTimeout: "स्थान अनुरोध समाप्त", unknownError: "अज्ञात त्रुटि", locationError: "स्थान त्रुटि", enableLocationFirst: "पहले अपना स्थान सक्षम करें", geolocationNotSupported: "जियोलोकेशन समर्थित नहीं", directionsTo: "की दिशा", followRedLine: "लाल रेखा का अनुसरण करें"},
    pa: {title: "ਵੈਨਕੂਵਰ DTES ਲਾਈਫਲਾਈਨ ਨਕਸ਼ਾ", subtitle: "ਨੁਕਸਾਨ ਘਟਾਉਣ, ਨਿਗਰਾਨੀ ਵਾਲੀ ਖਪਤ, ਭੋਜਨ ਬੈਂਕਾਂ ਤੱਕ ਤੁਰੰਤ ਪਹੁੰਚ", readyToUse: "ਵਰਤਣ ਲਈ ਤਿਆਰ", resourceCount: "ਤਸਦੀਕਸ਼ੁਦਾ ਸਥਾਨ", type: "ਕਿਸਮ", hours: "ਸਮਾਂ", call: "ਕਾਲ", getDirections: "ਦਿਸ਼ਾ-ਨਿਰਦੇਸ਼", openInMaps: "ਨਕਸ਼ੇ ਵਿੱਚ ਖੋਲ੍ਹੋ", showQRCode: "QR ਕੋਡ", locating: "ਸਥਾਨ ਲੱਭਿਆ ਜਾ ਰਿਹਾ ਹੈ...", locationFound: "ਸਥਾਨ ਮਿਲਿਆ!", locationUnavailable: "ਸਥਾਨ ਉਪਲਬਧ ਨਹੀਂ", enableLocation: "ਸਥਾਨ ਸੇਵਾਵਾਂ ਸਮਰੱਥ ਕਰੋ", locationTimeout: "ਸਥਾਨ ਬੇਨਤੀ ਸਮਾਪਤ", unknownError: "ਅਣਜਾਣ ਗਲਤੀ", locationError: "ਸਥਾਨ ਗਲਤੀ", enableLocationFirst: "ਪਹਿਲਾਂ ਆਪਣੀ ਸਥਿਤੀ ਸਮਰੱਥ ਕਰੋ", geolocationNotSupported: "ਜੀਓਲੋਕੇਸ਼ਨ ਸਮਰਥਿਤ ਨਹੀਂ", directionsTo: "ਦੀ ਦਿਸ਼ਾ", followRedLine: "ਲਾਲ ਲਾਈਨ ਦਾ ਪਾਲਣ ਕਰੋ"},
    de: {title: "Vancouver DTES Lifeline-Karte", subtitle: "Sofortiger Zugang zu Schadensminderung, überwachtem Konsum, Lebensmittelbanken", readyToUse: "Einsatzbereit", resourceCount: "verifizierte Standorte", type: "Typ", hours: "Öffnungszeiten", call: "Anrufen", getDirections: "Wegbeschreibung", openInMaps: "In Karten öffnen", showQRCode: "QR-Code anzeigen", locating: "Standort wird ermittelt...", locationFound: "Standort gefunden!", locationUnavailable: "Standort nicht verfügbar", enableLocation: "Standortdienste aktivieren", locationTimeout: "Standortanfrage abgelaufen", unknownError: "Unbekannter Fehler", locationError: "Standortfehler", enableLocationFirst: "Bitte aktivieren Sie zuerst Ihren Standort", geolocationNotSupported: "Geolokalisierung wird nicht unterstützt", directionsTo: "Wegbeschreibung zu", followRedLine: "Folgen Sie der roten Linie auf der Karte"},
    vi: {title: "Bản Đồ Đường Sống DTES Vancouver", subtitle: "Truy cập tức thì giảm tác hại, tiêu dùng có giám sát, ngân hàng thực phẩm", readyToUse: "Sẵn sàng sử dụng", resourceCount: "địa điểm đã xác minh", type: "Loại", hours: "Giờ", call: "Gọi", getDirections: "Lấy Chỉ Dẫn", openInMaps: "Mở trong Bản Đồ", showQRCode: "Hiển Thị Mã QR", locating: "Đang định vị...", locationFound: "Đã tìm thấy vị trí!", locationUnavailable: "Vị trí không khả dụng", enableLocation: "Vui lòng bật dịch vụ định vị", locationTimeout: "Yêu cầu định vị hết hạn", unknownError: "Đã xảy ra lỗi không xác định", locationError: "Lỗi định vị", enableLocationFirst: "Vui lòng bật vị trí của bạn trước bằng cách nhấp vào 'Tìm Vị Trí Của Tôi'", geolocationNotSupported: "Trình duyệt của bạn không hỗ trợ định vị địa lý", directionsTo: "Chỉ đường đến", followRedLine: "Theo dòng màu đỏ trên bản đồ"},
    bn: {title: "ভ্যানকুভার DTES লাইফলাইন মানচিত্র", subtitle: "ক্ষতি হ্রাস, ত্তবাবধানে সেবন, খাদ্য ব্যাংক, আশ্রয়কেন্দ্র এবং জরুরি যত্ন পরিষেবাগুলিতে তাত্ক্ষণিক অ্যাক্সেস", readyToUse: "ব্যবহারের জন্য প্রস্তুত", resourceCount: "যাচাইকৃত স্থান", type: "ধরন", hours: "সময়", call: "কল করুন", getDirections: "নির্দেশনা পান", openInMaps: "মানচিত্রে খুলুন", showQRCode: "কিউআর কোড দেখান", locating: "অবস্থান সনাক্ত করা হচ্ছে...", locationFound: "অবস্থান পাওয়া গেছে!", locationUnavailable: "অবস্থান পাওয়া যাচ্ছে না", enableLocation: "অনুগ্রহ করে অবস্থান পরিষেবা সক্ষম করুন", locationTimeout: "অবস্থানের অনুরোধের সময় শেষ", unknownError: "অজানা ত্রুটি ঘটেছে", locationError: "অবস্থান ত্রুটি", enableLocationFirst: "অনুগ্রহ করে প্রথমে 'আমার অবস্থান খুঁজুন'-এ ক্লিক করে আপনার অবস্থান সক্ষম করুন", geolocationNotSupported: "আপনার ব্রাউজার ভূ-অবস্থান সমর্থন করে না", directionsTo: "এর দিকে নির্দেশনা", followRedLine: "আপনার গন্তব্যে পৌঁছানোর জন্য মানচিত্রে লাল লাইন অনুসরণ করুন"},
    tl: {title: "Vancouver DTES Lifeline Map", subtitle: "Agad na access sa harm reduction, supervised consumption, food banks, shelters, detox centers, at urgent care services", readyToUse: "Handa na gamitin", resourceCount: "mga verified na lokasyon", type: "Uri", hours: "Oras", call: "Tawagan", getDirections: "Kumuha ng Mga Direksyon", openInMaps: "Buksan sa Maps", showQRCode: "Ipakita ang QR Code", locating: "Naghahanap ng lokasyon mo...", locationFound: "Nahanap ang lokasyon!", locationUnavailable: "Hindi available ang lokasyon", enableLocation: "Mangyaring i-enable ang mga serbisyo ng lokasyon", locationTimeout: "Na-time out ang request ng lokasyon", unknownError: "Nagkaroon ng hindi kilalang error", locationError: "Error sa lokasyon", enableLocationFirst: "Mangyaring i-enable muna ang iyong lokasyon sa pamamagitan ng pag-click sa 'Hanapin Ang Aking Lokasyon'", geolocationNotSupported: "Hindi suportado ng iyong browser ang geolocation", directionsTo: "Mga direksyon papuntang", followRedLine: "Sundan ang pulang linya sa mapa upang makarating sa iyong destinasyon"},
    ar: {title: "خريطة خط الحياة DTES فانكوفر", subtitle: "وصول فوري إلى خدمات الحد من الأضرار، الاستهلاك الخاضع للإشراف، بنوك الطعام، الملاجئ، مراكز إزالة السموم، وخدمات الرعاية العاجلة", readyToUse: "جاهز للاستخدام", resourceCount: "مواقع موثقة", type: "النوع", hours: "الساعات", call: "اتصل", getDirections: "احصل على الاتجاهات", openInMaps: "فتح في الخرائط", showQRCode: "عرض رمز الاستجابة السريعة", locating: "تحديد موقعك...", locationFound: "تم العثور على الموقع!", locationUnavailable: "الموقع غير متاح", enableLocation: "يرجى تمكين خدمات الموقع", locationTimeout: "انتهت مهلة طلب الموقع", unknownError: "حدث خطأ غير معروف", locationError: "خطأ في الموقع", enableLocationFirst: "يرجى تمكين موقعك أولاً بالنقر على "العثور على موقعي"", geolocationNotSupported: "الجيولوكاشن غير مدعوم من قبل متصفحك", directionsTo: "الاتجاهات إلى", followRedLine: "اتبع الخط الأحمر على الخريطة للوصول إلى وجهتك"},
    fa: {title: "نقشه خط حیات DTES ونکوور", subtitle: "دسترسی فوری به کاهش آسیب، مصرف تحت نظارت، بانک‌های مواد غذایی، پناهگاه‌ها، مراکز سم‌زدایی، وخدمات مراقبت فوری", readyToUse: "آماده استفاده", resourceCount: "مکان‌های تأیید شده", type: "نوع", hours: "ساعات", call: "تماس", getDirections: "دریافت مسیرها", openInMaps: "باز کردن در نقشه‌ها", showQRCode: "نمایش کد QR", locating: "در حال پیدا کردن موقعیت شما...", locationFound: "موقعیت پیدا شد!", locationUnavailable: "موقعیت در دسترس نیست", enableLocation: "لطفاً خدمات موقعیت مکانی را فعال کنید", locationTimeout: "زمان درخواست موقعیت به پایان رسید", unknownError: "خطای ناشناخته رخ داد", locationError: "خطای موقعیت مکانی", enableLocationFirst: "لطفاً ابتدا با کلیک بر روی "پیدا کردن موقعیت من" موقعیت خود را فعال کنید", geolocationNotSupported: "موقعیت جغرافیایی توسط مرورگر شما پشتیبانی نمی‌شود", directionsTo: "مسیرها به سمت", followRedLine: "خط قرمز روی نقشه را برای رسیدن به مقصد خود دنبال کنید"}
};

// ===================================================================
// MAP INITIALIZATION
// ===================================================================
function initMap() {
    try {
        // Check if Leaflet library loaded successfully
        if (typeof L === 'undefined') {
            throw new Error('Leaflet library failed to load');
        }

        // Initialize map centered on DTES
        map = L.map('map', {
            zoomControl: true,
            dragging: true,
            touchZoom: true,
            scrollWheelZoom: true,
            doubleClickZoom: true
        }).setView([49.2819, -123.1000], 15);

        // Add OpenStreetMap tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors',
            maxZoom: 19,
            minZoom: 12
        }).addTo(map);

        // Add all resource markers to map
        dtesResources.forEach(resource => {
            addMarker(resource);
        });

        // Hide loading overlay and show app
        setTimeout(() => {
            const overlay = document.getElementById('loadingOverlay');
            overlay.style.opacity = '0';
            setTimeout(() => {
                overlay.style.display = 'none';
                document.getElementById('mainAppContent').classList.remove('opacity-0');
                document.getElementById('map').style.opacity = '1';
            }, 500);
        }, 1500);

    } catch (error) {
        console.error('Map initialization error:', error);
        document.getElementById('loadingOverlay').innerHTML = `
            <div class="text-center px-8">
                <div class="mb-6">
                    <i class="fas fa-exclamation-triangle text-6xl text-yellow-500 mb-4"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Map Loading Issue</h2>
                <p class="text-gray-600 mb-4 text-lg">
                    The interactive map may not load in this environment,
                    but all resources are listed below and will work perfectly when deployed.
                </p>
                <div class="bg-blue-50 border-2 border-blue-200 rounded-lg p-4 mb-4">
                    <p class="text-blue-800 font-semibold">
                        <i class="fas fa-check-circle mr-2"></i>
                        ✅ This app is fully functional and offline-capable!
                    </p>
                </div>
                <div class="text-sm text-gray-500">
                    <p class="mb-2">All ${dtesResources.length} resources are loaded and searchable.</p>
                    <p>The map will work perfectly when deployed to a web server.</p>
                </div>
            </div>
        `;
    }
}

// ===================================================================
// ADD MARKER TO MAP
// ===================================================================
function addMarker(resource) {
    // Define color scheme for different resource types
    const iconColors = {
        'Naloxone': '#3B82F6',      // Blue
        'Injection Site': '#10B981', // Green
        'Detox': '#F97316',          // Orange
        'Food': '#9333EA',           // Purple
        'Shelter': '#b45309',        // Amber
        'Urgent': '#EF4444',         // Red
        'Washrooms': '#14B8A6',      // Teal
        'Mental Health': '#EC4899'   // Pink
    };

    // Create custom marker icon with better styling
    const customIcon = L.divIcon({
        className: 'custom-marker',
        html: `<div style="
            background: linear-gradient(135deg, ${iconColors[resource.type] || '#6B7280'} 0%, ${iconColors[resource.type] || '#4B5563'} 100%);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 4px 12px rgba(0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 12px;
        ">
            ${resource.type.charAt(0)}
        </div>`,
        iconSize: [36, 36],
        iconAnchor: [18, 18],
        popupAnchor: [0, -10]
    });

    // Create marker with popup
    const marker = L.marker([resource.lat, resource.lng], { icon: customIcon })
        .addTo(map)
        .bindPopup(createPopupContent(resource));

    // Store resource data with marker
    marker.resourceData = resource;
    markers.push(marker);
}

// ===================================================================
// CREATE POPUP CONTENT
// ===================================================================
function createPopupContent(resource) {
    const iconColors = {
        'Naloxone': '#3B82F6',      // Blue
        'Injection Site': '#10B981', // Green
        'Detox': '#F97316',          // Orange
        'Food': '#9333EA',           // Purple
        'Shelter': '#b45309',        // Amber
        'Urgent': '#EF4444',         // Red
        'Washrooms': '#14B8A6',      // Teal
        'Mental Health': '#EC4899'   // Pink
    };

    const statusClass = resource.status === 'open' ? 'status-open' : 
                       resource.status === 'closed' ? 'status-closed' : 'status-unknown';

    const safeName = resource.name.replace(/"/g, '&quot;').replace(/'/g, '&#39;');
    
    return `
        <div style="max-width: 320px; font-family: 'Inter', sans-serif;">
            <div style="background: linear-gradient(135deg, ${iconColors[resource.type] || '#6B7280'} 0%, ${iconColors[resource.type] || '#4B5563'} 100%); color: white; padding: 1rem; margin: -1rem -1rem 1rem 0; border-radius: 0.75rem 0.75rem 0 0;">
                <h3 style="font-weight: 700; margin: 0; font-size: 18px;">
                    ${resource.name}
                </h3>
            </div>
            <div style="padding: 1rem;">
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                    <span class="status-indicator ${statusClass}"></span>
                    <strong style="color: ${iconColors[resource.type] || '#6B7280'};">${translations[currentLanguage].type}:</strong> 
                    <span style="background: ${iconColors[resource.type] || '#6B7280'}; color: white; padding: 0.25rem 0.75rem; border-radius: 1rem; font-size: 0.75rem; margin-left: 0.5rem;">
                        ${resource.type}
                    </span>
                </div>
                <p style="margin-bottom: 0.75rem; line-height: 1.5; color: var(--gray-700);">
                    ${resource.description}
                </p>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 0.75rem; font-size: 0.875rem;">
                    <div>
                        <strong style="color: var(--gray-600);">${translations[currentLanguage].hours}:</strong>
                        <div style="color: var(--gray-800); font-weight: 500;">${resource.hours}</div>
                    </div>
                    <div>
                        <strong style="color: var(--gray-600);">${translations[currentLanguage].call}:</strong>
                        <div>
                            <a href="tel:${resource.phone}" style="color: var(--primary); text-decoration: none; font-weight: 600;" 
                               onmouseover="this.style.textDecoration='underline'" 
                               onmouseout="this.style.textDecoration='none'">
                                ${resource.phone}
                            </a>
                        </div>
                    </div>
                </div>
                <p style="margin-bottom: 1rem; font-size: 0.875rem; color: var(--gray-600);">
                    <i class="fas fa-map-marker-alt" style="color: var(--primary); margin-right: 0.5rem;"></i> 
                    ${resource.address}
                </p>
                <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                    <button 
                        onclick="getDirections(${resource.lat}, ${resource.lng}, '${safeName}');" 
                        class="popup-btn direction-btn"
                    >
                        <i class="fas fa-directions"></i> ${translations[currentLanguage].getDirections}
                    </button>
                    <button 
                        onclick="openInExternalMap(${resource.lat}, ${resource.lng}, '${safeName}');" 
                        class="popup-btn"
                        style="background: linear-gradient(135deg, var(--info) 0%, #2563EB 100%); color: white;"
                    >
                        <i class="fas fa-external-link-alt"></i> ${translations[currentLanguage].openInMaps}
                    </button>
                    <button 
                        onclick="showQRCode(${resource.lat}, ${resource.lng}, '${safeName}');" 
                        class="popup-btn"
                        style="background: linear-gradient(135deg, var(--success) 0%, #059669 100%); color: white;"
                    >
                        <i class="fas fa-qrcode"></i> ${translations[currentLanguage].showQRCode}
                    </button>
                </div>
            </div>
        </div>
    `;
}

// ===================================================================
// USER LOCATION FEATURE
// ===================================================================
document.getElementById('locateUserButton').addEventListener('click', () => {
    if (!navigator.geolocation) {
        alert(translations[currentLanguage].geolocationNotSupported);
        return;
    }

    const statusElement = document.getElementById('userLocationStatus');
    statusElement.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Locating you...';

    navigator.geolocation.getCurrentPosition(
        (position) => {
            userLat = position.coords.latitude;
            userLng = position.coords.longitude;

            // Remove old user location marker if exists
            if (userLocationMarker) {
                map.removeLayer(userLocationMarker);
            }

            // Create pulsing blue dot for user location
            const userIcon = L.divIcon({
                className: 'user-location-icon',
                iconSize: [24, 24],
                iconAnchor: [12, 12]
            });

            userLocationMarker = L.marker([userLat, userLng], { icon: userIcon })
                .addTo(map)
                .bindPopup('<strong style="font-size: 16px;">📍 You are here</strong><br><span style="font-size: 14px;">Your current location</span>');

            // Center map on user location with
